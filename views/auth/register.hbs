<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <h1 class="h4 mb-3 text-center">ƒêƒÉng k√Ω</h1>

                <div id="alert" class="alert d-none" role="alert"></div>

                <form id="registerForm" novalidate>

                    <!-- Email -->
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com"
                            required>
                    </div>

                    <!-- Password -->
                    <div class="mb-3">
                        <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
                        <input type="password" class="form-control" id="password" name="password" minlength="6"
                            required>
                        <div class="form-text">T·ªëi thi·ªÉu 6 k√Ω t·ª±.</div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-3">
                        <label for="confirm" class="form-label">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                        <input type="password" class="form-control" id="confirm" name="confirm" minlength="6" required>
                    </div>

                    <!-- Select Role -->
                    <div class="mb-3">
                        <label for="role" class="form-label">Vai tr√≤</label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="">-- Ch·ªçn vai tr√≤ --</option>
                            <option value="user">Ng∆∞·ªùi d√πng</option>
                            <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                        </select>
                    </div>

                    <!-- Radio Group: Gender -->
                    <div class="mb-3">
                        <label class="form-label d-block">Gi·ªõi t√≠nh</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="male" value="male" required>
                            <label class="form-check-label" for="male">Nam</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="gender" id="female" value="female">
                            <label class="form-check-label" for="female">N·ªØ</label>
                        </div>
                    </div>

                    <button class="btn btn-primary w-100" type="submit">T·∫°o t√†i kho·∫£n</button>
                </form>
            </div>
        </div>
        <p class="mt-3 text-center">
            ƒê√£ c√≥ t√†i kho·∫£n? <a href="/login">ƒêƒÉng nh·∫≠p</a>
        </p>
    </div>
</div>

<script>
    (function () {
        const form = document.querySelector('form');

        // üîπ H√†m hi·ªán Toast
        function showToast(message, type = 'primary') {
            const toastEl = document.getElementById('toast');
            const toastBody = document.getElementById('toastMessage');
            toastBody.textContent = message;

            // ƒê·ªïi m√†u n·ªÅn theo lo·∫°i
            toastEl.className = `toast align-items-center text-bg-${type} border-0`;

            const bsToast = new bootstrap.Toast(toastEl, { delay: 2500 });
            bsToast.show();
        }

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm').value;
            const role = document.getElementById('role').value;
            const gender = form.querySelector('input[name="gender"]:checked')?.value;

            // Validation
            if (!email || !password || !confirm || !role || !gender) {
                showToast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.', 'warning');
                return;
            }
            if (password.length < 6) {
                showToast('M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±.', 'warning');
                return;
            }
            if (password !== confirm) {
                showToast('M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√¥ng kh·ªõp.', 'warning');
                return;
            }

            try {
                const res = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, role, gender })
                });

                const data = await res.json().catch(() => ({}));

                if (!res.ok) {
                    const msg = (data && (data.message || data.error)) || 'ƒêƒÉng k√Ω th·∫•t b·∫°i.';
                    showToast(msg, 'danger'); // üîπ Email t·ªìn t·∫°i c≈©ng s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
                    return;
                } else {
                    sessionStorage.setItem('toastMessage', 'ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y ƒëƒÉng nh·∫≠p.');
                    sessionStorage.setItem('toastType', 'success');
                    window.location.href = '/login';
                }
            } catch (err) {
                showToast('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.', 'danger');
            }
        });
    })();
</script>